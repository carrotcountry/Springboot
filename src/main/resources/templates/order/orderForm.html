<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body>
<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader"/>
    <form method="post" >
        <div class="form-group">
            <label for="member">주문회원</label>
            <select name="memberId" id="member" class="form-control">
                <option value="">회원선택</option>
                <option
                        th:each="member : ${members}"
                        th:value="${member.id}"
                        th:text="${member.name}" />
            </select>
        </div>
        <div class="form-group">
            <label for="item">상품명</label>
            <select name="itemId" id="item" class="form-control">
                <option value="">상품선택</option>
                <option th:each="item : ${items}"
                        th:value="${item.id}"
                        th:text="${item.name}" />
            </select>
        </div>
        <div class="form-group">
            <label for="count">주문수량</label>
            <input type="number" name="count" class="form-control" id="count" placeholder="주문 수량을 입력하세요" onchange="orderBox3(this)" onclick="">
        </div>

        <div id='result'></div>

        <button onclick="orderArray()" id="btn" type="submit" class="btn btn-primary" style="margin-top: 20px;">Submit</button>
    </form>
    <br/>
    <div th:replace="fragments/footer :: footer" />
</div> <!-- /container -->
</body>
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/


    let qualified = 0;
    let arr = [];
    function orderBox3(e) {
        // let member = /*[[${member}]]*/;
        // let item = /*[[${member}]]*/;

        // 선택된 데이터 가져오기
        const value = e.value;
        // 데이터 출력
        const memberText = member.options[member.selectedIndex].text;
        const memberValue = member.options[member.selectedIndex].value;
        const count = document.getElementById("count");

        const itemValue = item.options[item.selectedIndex].value;

        const itemText = item.options[item.selectedIndex].text;

        let obj = {
            member: memberText,
            memberId: memberValue,
            item: itemText,
            count: count.value
        };

        arr.push(obj);

        if(qualified % 2 == 0 && value != "" && itemValue != "" && count.value != "") {

            const newDiv = document.createElement("div");
            const newContent1 = document.createTextNode(memberText + "      ");
            const newContent2 = document.createTextNode(itemText + "      ");
            const newContent3 = document.createTextNode(count.value);
            newDiv.appendChild(newContent1);
            newDiv.appendChild(newContent2);
            newDiv.appendChild(newContent3);
            const currentDiv = document.getElementById("div1");
            document.body.insertBefore(newDiv, currentDiv);

            // count.value = null;
            // member[0].selected = true;
            // item[0].selected = true;

            qualified = 0;

            const btn = document.getElementById("btn");
            btn.before(newDiv);

            members = memberValue;
            items = itemValue;

            console.log(arr);
            // console.log(members);
            // console.log(items);



            // id가 test2이고 value가 test2인 textbox를 생성한다.
        }
    }
    function orderArray() {
        $.ajax({
            // data: {"target" : JSON.stringify(arr)},
            data: JSON.stringify(arr),
            url: "/order",
            type: "POST",
            contentType: "application/json; charset=UTF-8",
            // dataType: "json",
            success: function (data) {
                console.log("gd");
            }
        });
    }

    /*]]>*/
</script>
<script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
        crossorigin="anonymous"></script>
</html>
